/*! bbfe - v0.0.1 */ !function(a,b,c,d){a(d).ready(function(){var e=c.PGM.touch?"touchend":"click";a("body").on(e,'a[rel="popup"]',function(a){a.preventDefault(),c.open(this.href,this.title,"location=1,status=1,scrollbars=0,height="+this.getAttribute("data-height")+",width="+this.getAttribute("data-width"))});var f=function(){var e=null,f=0;return function(g){var h=a(this);if("touchstart"!==g.type||h.hasClass("is-lasttouch")||(e=a(this),f=d.body.scrollTop),"touchend"===g.type){var i=d.body.scrollTop;h.is(e)&&f>0&&Math.abs(i-f)<50&&(h.siblings().removeClass("is-lasttouch"),b.defer(function(){c.PGM.debug("spotify","adding lasttouch"),h.addClass("is-lasttouch")}),e=null,f=0)}}}(),g=a(".chart-data");c.PGM.touch&&g.on("click",".chart-row__secondary-toggle .chart-row__link, .chart-row__player-toggle, .js-chart-row-vevo",function(a){a.preventDefault()}),g.on(e,".chart-row__link--toggle",function(b){b.preventDefault(),a(this).parents(".chart-row").toggleClass("secondary-row-is-visible")}).on(e,".js-chart-row-vevo",function(b){b.preventDefault(),a.magnificPopup.open({items:{src:a(this).attr("data-href")},type:"iframe"})}).find(".chart-row").each(function(){var b=a(this);b.waypoint(function(){var a=b.find(".chart-row__image"),c=a[0].getAttribute("data-imagesrc");c&&a.css("background-image","url("+c+")")},{offset:"125%",triggerOnce:!0})}).on("touchstart",f).on("touchend",f),a(".js-chart-taboola").each(function(){d.documentElement.clientWidth<1024?c.PGM.taboola.createWidget(this,{mode:"thumbnails-i",container:"taboola-right-rail-thumbnails",placement:"Mobile Mid Article Thumbnails"}):c.PGM.taboola.createWidget(this,{mode:"thumbnails-rr2",container:"taboola-mobile-mid-article-thumbnails",placement:"Right Rail Thumbnails"})}),a(".js-spotify-play-full").on(e,function(){var b=a(this);if(b.is(".is-lasttouch")||b.is(".is-active")||"none"!==b.css("display")){var d=b.attr("data-href");"undefined"!=typeof d&&(c.PGM.BB.Spotify.PreviewManager.pauseIfPlaying(),c.open(d,"_blank"))}})})}(this.jQuery,this._,this,this.document),function(a,b,c,d){a(d).ready(function(){var d=a("#twi-module");if(d.length){var e=a("#twi-form"),f=e.find("select"),g=a("#twi-target"),h=c.PGM.JST["chart/twi"],i=c._.after(2,function(){c.PGM.events.trigger("trackEvent",{action:d.attr("data-trackaction"),label:"Go"})});e.on("submit",function(c){var d=f.val();c.preventDefault(),g.html("<p>Loading&hellip;</p>"),i(),a.ajax(this.target+d,{success:function(a){if(b.isEmpty(a.row1))return void g.html("<p>We can't find data for "+d+". Try another year?</p>");var c={row1:a.row1,featured_content:a.response?a.response.featured_content:null};g.html(h(c))},error:function(a,b,c){g.html("<p>We're having trouble finding data for "+d+". Try another year?</p>"),console.error(c)}})}).trigger("submit"),f.on("click",function(){c.PGM.events.trigger("trackEvent",{action:d.attr("data-trackaction"),label:"Year Dropdown"})}).on("change",function(){e.trigger("submit")})}})}(this.jQuery,this._,this,this.document),function(a,b,c,d,e){var f={patterns:{illegal_chars:/[^0-9\/]/g,regex_three_digits:/^[0-9]{3}/g,regex_seg_three_digits:/^[0|1]{1}[0-9]{1}\/[0-3]{1}[0-9]{2}/g,regex_seg_1:/^[0|1]{1}[0-9]{1}/g,regex_seg_1_slash:/^[0|1]{1}[0-9]{1}\//g,regex_one_digit_zero:/^[0]\//g,regex_one_digit:/[1-9]\//g,regex_seg_2:/^[0|1]{1}[0-9]{1}\/[0-3]{1}[0-9]{1}/g,regex_two_digit:/\/[1-9]{1}\//g,regex_seg_3:/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/g,regex_no_slashes:/[0-9]{2}\/[0-9]{2}[\/]{1,4}/g},setAllTimers:function(a,b,c,d,e){"use strict";f.setIllegalCharsTimer(a,b),f.setSegOneTimer(a,c),f.setSegTwoTimer(a,d),f.setSegThreeTimer(a,e)},clearAllTimers:function(a,b,c,d){"use strict";clearInterval(a),clearInterval(b),clearInterval(c),clearInterval(d),a=0,b=0,c=0,d=0},evaluateState:function(a,b,c){"use strict";1===a.value.length&&0===b&&f.setSegOneTimer(a,b),4===a.value.length&&0===c&&f.setSegTwoTimer(a,c)},setIllegalCharsTimer:function(a,b){"use strict";b=setInterval(function(){f.removeIllegalChars(a)},50)},setSegOneTimer:function(a,b){"use strict";b=setInterval(function(){f.cleanSegmentOne(a,b)},50)},setSegTwoTimer:function(a,b){"use strict";b=setInterval(function(){f.cleanSegmentTwo(a,b)},50)},setSegThreeTimer:function(a,b){"use strict";b=setInterval(function(){f.cleanSegmentThree(a)},50)},removeIllegalChars:function(a){"use strict";f.patterns.illegal_chars.test(a.value)&&(a.value=a.value.replace(f.patterns.illegal_chars,""))},cleanSegmentOne:function(a,b){"use strict";var c,d=a.value,e=a.value.length;1===e&&"/"===d&&(a.value=""),2===e&&f.patterns.regex_one_digit.test(d)&&(a.value="0"+d,clearInterval(b),b=0),2===e&&f.patterns.regex_one_digit_zero.test(d)&&(a.value=""),2===e&&"00"===d&&(a.value=""),2===e&&(c=d,c>12&&(a.value=d.replace(c,""))),2===e&&f.patterns.regex_seg_1.test(d)&&(a.value=a.value+"/",clearInterval(b),b=0),3===e&&f.patterns.regex_seg_1_slash.test(d)&&(clearInterval(b),b=0)},cleanSegmentTwo:function(a,b){"use strict";var c,d,e=a.value.substring(0,3);4===a.value.length&&a.value===e+"/"&&(a.value=e),5===a.value.length&&(c=a.value.substring(3),c>31&&(a.value=a.value.replace(c,""))),5===a.value.length&&a.value===e+"0/"&&(a.value=e),5===a.value.length&&"00"===c&&(a.value=a.value.replace(c,"")),5===a.value.length&&f.patterns.regex_two_digit.test(a.value)&&(d=a.value.substring(3,4),a.value=e+"0"+d),5===a.value.length&&f.patterns.regex_seg_2.test(a.value)&&(a.value=a.value+"/",clearInterval(b),b=0),6===a.value.length&&f.patterns.regex_seg_2.test(a.value)&&(clearInterval(b),b=0)},cleanSegmentThree:function(a){"use strict";var b;"/"!==a.value.substring(6,7)&&"/"!==a.value.substring(7,8)&&"/"!==a.value.substring(8,9)&&"/"!==a.value.substring(9,10)||(a.value=a.value.substring(0,a.value.length-1)),10===a.value.length&&f.patterns.regex_seg_3.test(a.value)&&(b=a.value),a.value.length>10&&(a.value=a.value.substring(0,a.value.length-1))},registerInputId:function(b){"use strict";return{formatDate:function(){var c,e=d.getElementById(b),g=0,h=0,i=0,j=0,k=0;c=a(e),c.on("focus",function(){f.setAllTimers(this,g,h,i,i)}),c.on("keypress",function(a){k>1&&a.preventDefault(),k++}),c.on("keyup keydown",function(){var a=this.value.substring(2,3),b=this.value.substring(5,6);k=0,3===this.value.length&&f.patterns.regex_three_digits.test(this.value)&&(this.value=this.value.substring(0,this.value.length-1)+"/"+a),6===this.value.length&&f.patterns.regex_seg_three_digits.test(this.value)&&(this.value=this.value.substring(0,this.value.length-1)+"/"+b),f.evaluateState(this,h,i)}),c.on("blur",function(){f.clearAllTimers(g,h,i,j)})}}}};a(d).ready(function(){var e=a("#twi-module");if(e.length){var g=f.registerInputId("twi-birthday-date");g.formatDate();var h=a("#twi-birthday-date"),i=a("#twi-module-birthday-target"),j=c.PGM.JST["chart/twi_birthday"],k=new Date("1954-01-01"),l=new Date("1900-01-01");a("#twi-birthday-form").on("submit",function(c){c.preventDefault(),i.html("<p>Loading&hellip;</p>");var f=h.val().split("/"),g=[f[2],f[0],f[1]].join("-"),m=new Date(g),n=null;return m.valueOf()<l.valueOf()?n="There was music back then?":m.valueOf()<k.valueOf()?n="Sorry, we don't have data before 1954.":m.valueOf()>Date.now()&&(n="Nice try."),n?void i.html("<p>"+n+"</p>"):void a.ajax(this.target+g,{success:function(c){return b.isEmpty(c.rows)?void i.html("<p>We're having trouble loading the chart for that date. Try another one?</p>"):void i.html(j(a.extend(c,{canonical:e.data("canonical")||d.location.origin+d.location.pathname})))},error:function(a,b,c){i.html("<p>We're having trouble loading the chart for that date. Try another one?</p>"),console.error(c)}})})}})}(this.jQuery,this._,this,this.document),function(a,b,c){c(b).ready(function(){c(".gallery-slides .slide-image-container").one("mouseenter",function(){var b=c(this);a.PGM.events.trigger("trackEvent",{action:b.parents("[data-trackaction]")[0].getAttribute("data-trackaction"),label:b.attr("data-hovertracklabel")})})})}(this,this.document,this.jQuery),function(a,b,c){a(c).ready(function(){a(".content-dropdown").each(function(){var b=this;a(".content-dropdown-trigger",b).on("click touchend",function(c){c.preventDefault(),a(".content-dropdown-target",b).slideToggle()})})})}(this.jQuery,this,this.document),function(a,b,c,d,e){a(d).ready(function(){c.enquire.register("(min-width: 1024px)",{match:function(){a.railSliders.recalculate(!0)},unmatch:function(){a.railSliders.disable()},deferSetup:!0,setup:function(){a(".bb-sliding > div:first-child").railSlider({headerOffset:10})}});var b=a(".chart-data"),d=a(".js-chart-rail-float");b.length>0&&d.length>0&&c.enquire.register("(min-width: 1024px)",{match:function(){b.waypoint({offset:-250,handler:function(a){"down"===a?(b.addClass("is-scrolled-past"),d.css("position","fixed")):(b.removeClass("is-scrolled-past"),d.css("position","static"))}})},unmatch:function(){b.removeClass("is-scrolled-past"),d.css("position","static")}})})}(this.jQuery,this._,this,this.document),function(a,b,c){a(c).ready(function(){a(".newsletter-form-ajax").submit(function(b){b.preventDefault(),a(".loading",this).show(),a(".newsletter-form .messages").empty();var c="/fe-ajax/newsletter_signup/"+a('[name="email"]',this).val()+"/"+a('[name="list"]',this).val();a(".newsletter-form").data("bb-submitted-email",a('[name="email"]',this).val()),a.ajax({url:c,error:function(){a(".newsletter-form .messages").append('<div class="error">Encountered an unexpected error. Please try again.</div>')},success:function(b){switch(b){case 0:a(".newsletter-form").find(".description, form").hide();var c=a(".newsletter-form").data("bb-submitted-email");a(".newsletter-form .messages").append('<div class="success"><h3>Thank you!</h3><p>You will start seeing emails from us soon at '+c+'. Please be sure to <a target="_blank" href="http://link.billboard.com/manage/38q/bb-preferences?email='+c+'">check out all of our newsletters!</a></p></div>');break;case 6:a(".newsletter-form .messages").append('<div class="error">Please enter a valid email address.</div>');break;default:a(".newsletter-form .messages").append('<div class="error">Please enter a valid email address.</div>')}},complete:function(){a(".newsletter-form .loading").hide()}})})})}(this.jQuery,this,this.document),function(a,b,c){a(c).ready(function(){a(".yim-swiper-container, .yim-swiper-carousel").each(function(){var c={calculateHeight:!0,createPagination:!1,mode:"horizontal",speed:300,preloadImages:!0,setWrapperSize:!0,updateOnImagesReady:!0,onSwiperCreated:function(a){setTimeout(function(){a.reInit(!0)},250)}};a(this).is(".yim-swiper-carousel")?a.extend(c,{slidesPerView:"auto"}):a.extend(c,{autoplay:3e3,loop:!0}),a.extend(c,a(this).data("swiper-params")||{}),a(this).data("swiper-original-params",a.extend({},c)),new b.Swiper(this,c)}),a(".yim-swiper-container .previous, .yim-swiper-carousel .previous").on("click touchend",function(b){b.preventDefault(),a(this).closest(".yim-swiper-container, .yim-swiper-carousel").data("swiper").slidePrev()}),a(".yim-swiper-container .next, .yim-swiper-carousel .next").on("click touchend",function(b){b.preventDefault(),a(this).closest(".yim-swiper-container, .yim-swiper-carousel").data("swiper").slideNext()}),b.enquire.register("screen and (max-width: 768px)",{match:function(){a(".yim-swiper-carousel, .yim-swiper-container").each(function(){a.extend(a(this).data("swiper").params,a(this).data("swiper-original-params"))})}}),b.enquire.register("screen and (min-width: 768px) and (max-width: 1023px)",{match:function(){a(".yim-swiper-carousel, .yim-swiper-container").each(function(){a.extend(a(this).data("swiper").params,a(this).data("swiper-original-params"),a(this).data("swiper-params-small")||{})})}}),b.enquire.register("screen and (min-width: 1023px)",{match:function(){a(".yim-swiper-carousel, .yim-swiper-container").each(function(){a.extend(a(this).data("swiper").params,a(this).data("swiper-original-params"),a(this).data("swiper-params-small")||{},a(this).data("swiper-params-medium")||{})})}})})}(this.jQuery,this,this.document),function(a,b,c){a(c).ready(function(){a(".compare-charts .column").each(function(){var c=this;a(".chart-selector-trigger",c).on("click touchend",function(b){b.preventDefault(),a(".chart-selector-target",c).slideToggle()}),a(".chart-select",c).on("click touchend",function(d){var e=a(this),f=e.text(),g=e.attr("href"),h=e.data("chart-type");d.preventDefault(),a(".chart-selector-target",c).slideUp(),a.getJSON(e.data("chart-endpoint"),function(d){d.chart_type=h,a("#chart-compare-template").html()&&(a(".chart-content",c).html(b.PGM.JST["yim/chart_compare"](d)),a(".chart-title",c).html(f),a(".see-the-rest",c).attr("href",g))})})})})}(this.jQuery,this,this.document),function(a,b,c){a(c).ready(function(){b.enquire.register("screen and (min-width: 768px) and (max-width: 1023px)",{match:function(){a(".chart-list").each(function(){var b=a(this).data("childHeight");b||(b=0,a("article",this).each(function(){a(this).height()>b&&(b=a(this).height())}),a(this).data("childHeight",b)),a(".read-more",this).css({height:b+"px",lineHeight:b+"px"})})},unmatch:function(){a(".chart-list .read-more").css({height:"auto",lineHeight:"inherit"})}})})}(this.jQuery,this,this.document),function(a,b,c){a(c).ready(function(){var c=a(".chart-row");c.one("mouseenter",function(){var c=a(this);b.PGM.events.trigger("trackEvent",{action:c.parents("[data-trackaction]")[0].getAttribute("data-trackaction"),label:c.attr("data-hovertracklabel")})}),c.length<=20||c.filter(":nth-of-type(10n+11)").each(function(c){a(this).waypoint(function(){b.PGM.events.trigger("trackPageview",{path:b.location.pathname+"?page="+(c+1)})},{offset:"100%"})})})}(this.jQuery,this,this.document),function(a,b){b.onTemplateLoaded=function(c){a(function(){var d=b.brightcove.api.getExperience(c),e=d.getModule(b.brightcove.api.modules.APIModules.VIDEO_PLAYER);a("#"+c).closest(".video-container").data("brightcove-player",e),b.brightcovePlayWhenReady&&b.brightcovePlayWhenReady.trigger("click")})},b.onTemplateReady=function(c){a(function(){var d=c.target.experience.id,e=b.brightcove.api.getExperience(d),f=e.getModule(b.brightcove.api.modules.APIModules.VIDEO_PLAYER);f.mediaEventAdded||(f.addEventListener(b.brightcove.api.events.MediaEvent.COMPLETE,function(){a("#"+d).closest(".video-container").trigger("MediaEvent.COMPLETE",c)}),f.mediaEventAdded=!0)})},a(function(){a('article:not(".clone") .play-video, .image-container .play-video').on("click",function(c){c.preventDefault(),a(this).closest(".video-container").addClass("video-active");var d=a(this).data("video-id"),e=a(this).closest(".video-container").data("brightcove-player");if(!e)return void(b.brightcovePlayWhenReady=a(this));e.loadVideoByID(d),a(this).closest(".video-playlist").find("article").removeClass("active");var f=a(this).closest("article").addClass("active");a(this).closest(".video-container").find(".video-info").html(f.clone().addClass("clone"))}),a(".video-playlist .read-more").on("click",function(b){b.preventDefault(),a(this).closest(".video-playlist").find(".more-group-active").each(function(){a(this).next(".more-group").length>0?a(this).next(".more-group").addClass("more-group-active"):a(this).parent().find(".more-group:first").addClass("more-group-active"),a(this).removeClass("more-group-active")})}),a(".video-container").on("MediaEvent.COMPLETE",function(){a(this).find("article.active").next("article").find(".play-video").trigger("click")})})}(this.jQuery,this),function(a,b){a(function(){a("#breaking-news").each(function(){var c=this.textContent.replace(/[^a-zA-Z0-9]/g,"");return(a.cookie("bb_news_close")!==c||window.PGM.debug.isEnabled("breaking"))&&a("body").addClass("breaking-news--is-showing").on("click",".breaking-news__close",function(){b.body.className=b.body.className.replace("breaking-news--is-showing",""),a.cookie("bb_news_close",c,{expires:1})}),!1})})}(this.jQuery,this.document),function(a,b,c){a(c).ready(function(){var d=a(".nav-items");a(".nav-toggle").toggler({toggleTarget:d,toggleClass:"open"});var e=a(".search-wrap");a(".search-toggle").on("click",function(){e.toggleClass("open")}),b.enquire.register("screen and (max-width: 1024px)",{match:function(){d.on("click.mobile",".dropdown i",function(b){b.preventDefault(),a(this).parent().siblings("ul").toggleClass("open")})},unmatch:function(){d.off(".mobile"),a(".site-header-old").find(".open").removeClass("open")}}),/iPhone|iPod|Android|iPad/.test(b.navigator.platform)&&a(c).on("focus","textarea,input,select",function(){a(".navbar.navbar-fixed-top").css("position","absolute")}).on("blur","textarea,input,select",function(){a(".navbar.navbar-fixed-top").css("position","")})})}(this.jQuery,this,this.document),function(a,b,c){a(c).ready(function(){var c=a("#how-it-works");a(".js-how-it-works-open, .js-how-it-works-close").toggler({toggleTarget:c,toggleClass:"is-showing-how-it-works"}).one("click",function(){b.PGM.events.trigger("trackEvent",{action:"Chart Header",lable:"How It Works"})}),a(".js-how-it-works-show-details").on("click",function(){c.addClass("is-showing-narrative")});var d=a(".swiper-wrapper"),e=null,f=null;b.enquire.register("screen and (max-width: 1023px)",{match:function(){e=[],f=d.wrap('<div class="swiper-container">').parent().append('<div class="pagination">'),f.each(function(){e.push(new b.Swiper(this,{calculateHeight:!0,createPagination:!0,pagination:this.lastChild,paginationClickable:!0}))})},unmatch:function(){f&&(f.each(function(b){e[b].destroy();var c=a(this);c.find(".swiper-wrapper").insertBefore(c).removeAttr("style").find(".swiper-slide").removeAttr("style")}).remove(),f=e=null)}})})}(this.jQuery,this,this.document),function(a,b,c,d,e,f){var g=c(a),h=new e.Marionette.Application;h.Model={},h.View={},h.Layout={},h.Router={},h.models={},h.models.syncedGalleryPage=null;var i=function(d){var e=d.get("adInterval"),f={};a.PGM.events.on("gallery:activeSlide-post",function(d){var g=d.get("gallery").get("nid"),h=d.get("slideIndex");if(b.title=d.get("gallery").get("seoTitle"),a.PGM.debug("gevents","tracking scroll events for "+a.location.pathname),a.PGM.events.trigger("trackPageview"),0!==h&&(h%2===1&&(a.PGM.debug("gevents","here we will track comscore for slideIndex",h),c.ajax("/aux/comscore-pageview-candidate/"+g+"/"+h)),(h+1)%e===0)){var i=g+"-"+h;i in f||(f[i]=!0,a.PGM.debug("gevents","left rail refresh with cache hash",f),a.PGM.events.trigger("ads:refresh",c(".left-rail .dfp-ad").attr("id")))}})};h.Model.Gallery=e.Model.extend({parse:function(a){var b=new Date(1e3*a.published_date),c=b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear(),d=a.primary_category&&a.primary_category.length>0?a.primary_category[0].name:null,f=a.primary_category&&a.primary_category.length>0?a.primary_category[0].path:null;return{nid:+a.nid,coreCanonical:a.core_canonical,title:a.title,seoTitle:a.seoTitle,category:d,categoryPath:f,tag:a.tags,published:a.published_date,displayPublished:c,bylines:new e.Collection(a.byline,{model:h.Model.Byline,parse:!0}),slides:new h.Model.SlidesCollection,numSlides:a.slides.length,displayNumSlides:("000"+a.slides.length).substr(-3),activeSlideIndex:0}},initialize:function(a){for(var b=h.models.syncedGalleryPage.get("adInterval"),c=0;c<a.slides.length;){var d=a.slides[c];d.gallery=this,d.slideIndex=c,this.get("slides").add(d,{parse:!0}),++c%b===0&&this.get("slides").add({adSlot:"g1"},{parse:!0})}}}),h.Model.Byline=e.Model.extend({parse:function(a){return{text:a.full_name,path:a.path}}}),h.Model.Galleries=e.Collection.extend({model:h.Model.Gallery,url:function(){return h.models.syncedGalleryPage.getNextGalleryApiUrl()},fetch:function(){if(this.fetching)return void a.PGM.debug("gfetch","already fetching, so paused for Galleries");var b=this.url();null!==b?(this.fetching=!0,a.PGM.debug("gfetch","fetching a Gallery from",b),c.ajax({url:b,type:"get",dataType:"JSON",success:d.bind(this.loadGallery,this)})):(a.PGM.debug("gfetch","not fetching a Gallery, waiting for left rail"),a.PGM.events.on("gallery:leftRailShown",d.bind(this.fetch,this)))},loadGallery:function(b){b&&b.msg&&b.msg.content&&b.msg.content.gallery?(b.msg.content.gallery.nid=b.msg.nid,b.msg.content.gallery.core_canonical=b.msg.canonical,b.msg.content.gallery.seoTitle=b.msg.metatags.title,this.fetching=!1,this.add(b.msg.content.gallery,{parse:!0})):a.PGM.debug(" gallery","unable to process response",b)}}),h.Model.PromoGallery=e.Model.extend({parse:function(b){var c=null,d=null;b.primary_category&&b.primary_category.length>0&&(c=b.primary_category[0].name,d=b.primary_category[0].path);var e=b.content.main_image&&b.content.main_image.path||null,f=e.substr(6),g="/files/styles/",h="left_rail_110x110",i="/public";return{id:+b.nid,nid:+b.nid,type:"promo",title:b.content.title,category:c,categoryPath:d,path:b.path,numSlides:b.content.slides_qty,image:f?a.BB.config.mediaHost+g+h+i+f:null}}}),h.Model.PromoGalleries=e.Collection.extend({model:function(a,b){return a.adSlot?new h.Model.AdSlide(a,b):new h.Model.PromoGallery(a,b)},initialize:function(a,b){this.fromGallery=b.initial},fetch:function(){if(null===this.fromGallery)return void a.PGM.debug("gallery","fetching no more PromoGalleries");if(this.fetching)return void a.PGM.debug("gallery","fetching paused for PromoGalleries");this.fetching=!0,a.PGM.debug("gallery","fetching more PromoGalleries with fromGallery",this.fromGallery);var b="/fe-ajax/v1/collection?types=photo_gallery&orderBy=changed&orderDir=DESC&offset=0&limit=20&mode=digest&fromNid="+this.fromGallery;c.ajax({url:b,type:"get",dataType:"JSON",success:d.bind(this.loadGalleries,this)})},loadGalleries:function(b){if(b&&b.msg&&b.msg.items&&b.msg.items.length){var c=b.msg.items;if(c.length<2)return void(this.fromGallery=null);var d=!0;this.models.length&&this.models[this.models.length-1].get("nid")===c[0].nid&&(c=c.slice(1),d=!1),this.fromGallery=c[c.length-1].nid,d&&c.splice(2,0,{adSlot:"m1"}),this.add(c,{parse:!0}),this.fetching=!1}else a.PGM.debug(" gallery","unable to process response",b)},resetGalleries:function(b){var c=this.get(b);if(null===c)return void a.PGM.debug("greset","did not find an active promo gallery for: ",b);a.PGM.debug("greset","found an active promo gallery: ",c);var d=this.indexOf(c);if(d>2){var e=this.models;e.shift(),e.shift(),e.splice(2,0,e.splice(0,1)[0]),this.reset(e)}this.trigger("resetGalleries")}}),h.Model.SyncedGalleryPage=e.Model.extend({setup:function(a){this.set("lastFetchedIndex",0),this.set("adInterval",a.adInterval),this.set("galleries",new h.Model.Galleries([a.gallery],{model:h.Model.Gallery,parse:!0})),this.set("promoGalleries",new h.Model.PromoGalleries([],{initial:a.nid,parse:!0})),this.set("activeGallery",this.get("galleries").models[0]),i(this)},getNextGalleryApiUrl:function(){var b=this.get("promoGalleries").models;if(!b||!b.length)return null;for(var c=this.get("lastFetchedIndex")+1;c<b.length;){var d=b[c].get("nid");if(d)return this.set("lastFetchedIndex",c),"/fe-ajax/v0/photos/"+d;c++}return a.PGM.debug("gfetch","no gallery to fetch"),null},goToSlide:function(b){var c=this.get("galleries");if(1===c.length){var d=c.models[0],e=d.get("slides");e.length>b&&(d.set("activeSlideIndex",b-1+Math.floor((b-1)/this.get("adInterval"))),a.PGM.events.trigger("gallery:setInitialSlide",b))}}}),h.Model.Slide=e.Model.extend({parse:function(b){var c=b.path?b.path.indexOf(a.BB.config.mediaHost)===-1?a.BB.config.mediaHost+b.path:b.path:"";return c=c.replace("/files/","/files/styles/900_wide/public/"),{gallery:b.gallery,type:"image",title:b.slide_title,body:b.body,credit:b.credit,embed:b.embed,src:c,videoId:null,slideIndex:b.slideIndex,displayIndex:("000"+(b.slideIndex+1)).substr(-3)}}}),h.Model.AdSlide=h.Model.Slide.extend({parse:function(a){return{type:"ad",adSlot:a.adSlot}}}),h.Model.SlidesCollection=e.Collection.extend({model:function(a,b){return a.adSlot?new h.Model.AdSlide(a,b):new h.Model.Slide(a,b)}}),h.View.Slide=f.ItemView.extend({className:"swiper-slide",template:a.PGM.JST["gallery/slide"],onShow:function(){"undefined"!=typeof this.model.get("slideIndex")&&this.$el.attr("data-slideHash",this.model.get("slideIndex")+1)},serializeData:function(){var b=this.model.toJSON();return b.gallery=this.model.get("gallery").toJSON(),b.trackEnv=a.PGM.touch?"m":"d",b.social={},d.each({url:[a.BB.config.contentHost,b.gallery.coreCanonical.replace(/^\//,""),this.model.get("slideIndex")+1].join("/"),title:null!==this.model.get("title")?this.model.get("title"):this.model.get("gallery").get("title")},function(a,c){b.social[c]=encodeURIComponent(a)}),b}}),h.View.AdSlide=f.ItemView.extend({className:"ad-slide",template:a.PGM.JST["gallery/adslide"],serializeData:function(){var b=this.model.toJSON();return b.trackEnv=a.PGM.touch?"m":"d",b},onRender:function(){return"undefined"==typeof a.PGM.ads.data.slots[this.model.get("adSlot")]?(a.PGM.debug("gallery","removing ad for slot",this.model.get("adSlot")),void this.remove()):void this.$(".ad-slide__container").html(a.PGM.JST["ads/slot"]({slot:a.PGM.ads.data.slots[this.model.get("adSlot")],name:"Gallery Ad"}))}}),h.View.LeftRailAdSlide=h.View.AdSlide.extend({className:"rail-ad",onShow:function(){a.PGM.events.trigger("contentLoaded",this.$el),d.defer(d.bind(function(){a.PGM.events.trigger("ads:refresh",this.$(".dfp-ad").attr("id"))},this))}}),h.View.Gallery=f.CompositeView.extend({serializeData:function(){var b=this.model.toJSON();return b.bylines=this.model.get("bylines").toJSON(),b.firstGallery=!1,this.model.cid===h.models.syncedGalleryPage.get("galleries").at(0).cid&&(b.firstGallery=!0),b.trackEnv=a.PGM.touch?"m":"d",b.social={},d.each({url:[a.BB.config.contentHost,this.model.get("coreCanonical").replace(/^\//,"")].join("/"),title:null!==this.model.get("title")?this.model.get("title"):this.model.get("gallery").get("title"),firstImageSrc:this.model.get("slides").at(0)?this.model.get("slides").at(0).get("src"):null},function(a,c){b.social[c]=encodeURIComponent(a)}),b},initialize:function(b){this.collection=this.model.get("slides"),this.data=b,a.PGM.events.on("gallery:setInitialSlide",d.bind(function(a){this.goToInitialSlide(a)},this))},onImagesReady:function(b){var c=this.$("img");a.PGM.debug("gfetch","onImagesReady found "+c.length+" images.");var d=!1,e=!0,f=function(b,c,f){if(!d){var g=b.filter(function(a,b){return!b.complete});0===g.length?(d=!0,a.PGM.debug("gfetch","onImagesReady running callback."),c()):e&&(e=!1,a.PGM.debug("gfetch","onImagesReady setting up waiter."),g.on("load",function(){f(b,c,f)}))}};f(c,b,f)},createScrollWaypoints:function(b){b.$el.waypoint({handler:d.bind(function(c){if("down"===c)a.PGM.events.trigger("gallery:activeSlide",b.model,b.$el);else{for(var d=this.collection.indexOf(b.model)-1,e=null;d>=0;){var f=this.collection.at(d);if("ad"!==f.get("type")){e=f;break}d--}null!==e&&a.PGM.events.trigger("gallery:activeSlide",e,b.$el.prevAll("[data-slideHash]").first())}},this),offset:"49%"})},onShow:function(){this.$el.data("nid",this.model.get("nid")),this.$el.attr("data-coreCanonical",this.model.get("coreCanonical")),this.$el.attr("data-trackaction",this.model.get("title")),this.onImagesReady(d.bind(function(){this.imagesLoaded=!0,this.initialIndex&&this.goToInitialSlide(),this.children.each(d.bind(function(a){a instanceof h.View.Slide&&this.createScrollWaypoints(a)},this)),this.$el.filter(":not(:first-child)").waypoint({handler:d.bind(function(b){var c="down"===b?this.$el:this.$el.prev();a.PGM.events.trigger("gallery:activeGallery",c),a.PGM.events.trigger("ads:refresh",d.pluck(c.find(".dfp-ad"),"id"))},this),offset:"50%"}),a.PGM.debug("gfetch","setting up waypoint for fetch"),this.$el.waypoint({handler:d.bind(function(){a.PGM.debug("gfetch","triggered waypoint for fetch"),this.data.collectionView.collection.fetch()},this),offset:d.bind(function(){return-this.$el.outerHeight()/2},this),triggerOnce:!0}),a.PGM.events.trigger("gallery:slidesReady")},this)),a.PGM.events.trigger("contentLoaded",this.$el)},goToInitialSlide:function(b){"undefined"!=typeof b&&(this.initialIndex=b),this.imagesLoaded&&(a.PGM.debug("gallery","gallery is going to initial slide ",this.initialIndex),a.scrollTo(0,this.$('[data-slidehash="'+this.initialIndex+'"]').offset().top))},getChildView:function(b){var c=b.get("type");return"image"===c?h.View.Slide:"ad"===c?h.View.AdSlide:void a.PGM.debug("gallery","unknown child view for ",c)}}),h.View.Galleries=f.CollectionView.extend({childView:h.View.Gallery,sort:!1,alreadySetIntialActive:!1,initialize:function(b){this.data=b,a.PGM.events.on("gallery:leftRailShown",d.bind(function(){this.alreadySetIntialActive||"undefined"!=typeof this.children&&this.children.length>0&&(this.alreadySetIntialActive=!0,a.PGM.events.trigger("gallery:activeGallery",this.$el.children().first()))},this))},buildChildView:function(a,b,c){var e=d.extend({collectionView:this,model:a},c);return new h.View.Gallery(e)}}),h.View.PromoGallery=f.ItemView.extend({className:"rail-item",miniClassName:"left-rail__gallery-item--mini",template:a.PGM.JST["gallery/promo-gallery"],serializeData:function(){var a=this.model.toJSON();return a.itemNumber=this.options.itemNumber,a}}),h.View.PromoGalleries=f.CollectionView.extend({className:"left-rail__list",sort:!1,attributes:{"data-trackaction":"Side-Bar"},getChildView:function(b){var c=b.get("type");return"promo"===c?h.View.PromoGallery:"ad"===c?h.View.LeftRailAdSlide:void a.PGM.debug("gallery","unknown child view for ",c)},childViewOptions:function(a,b){return{itemNumber:b+1}},initialize:function(b){this.wellGalleriesView=b.wellGalleriesView,a.PGM.events.on("gallery:activeGallery",d.bind(function(b){var c=b.data("nid");if(this.collection.resetGalleries(c),!b||0===b.length)return void a.PGM.debug("gallery","not checking promo galleries against newlyActive",b);var e=!1;this.children.each(d.bind(function(a){var d=a.$el.find(".rail-item__progress");0!==d.length&&(a.model.get("nid")===c?(a.$el.addClass("is-active"),g.on("scroll resize",this.generateProgressFunction(b,d)),e=!0):(a.$el.removeClass("is-active"),d.val(e?0:1).attr("max",1),g.off(".galleryProgressBar")))},this)),e||a.PGM.debug("gallery","no active promo gallery found for",c)},this)),this.collection.on("resetGalleries",d.bind(this.scrollToTop,this))},scrollToTop:function(){this.el.scrollTop=0},generateProgressFunction:function(a,b){return d.throttle(function(){var c=a.offset().top-g.height()/2;b.val(g.scrollTop()-c).attr("max",a.outerHeight())},250)},onChildviewShow:function(){this.children.length===this.collection.length&&(this.$el.children().last().waypoint({handler:d.bind(function(){this.collection.fetch()},this),offset:"150%",triggerOnce:!0}),a.PGM.events.trigger("gallery:leftRailShown"))},onShow:function(){this.collection.fetch(),this.wellGalleriesView.$el.waypoint(d.bind(function(a){"down"===a&&this.$el.parent().addClass("sticky-left-rail"),"up"===a&&this.$el.parent().removeClass("sticky-left-rail")},this))}}),h.Layout.CommonLayout=f.LayoutView.extend({initialize:function(a){this.options=d.extend({},a,this.getConfiguration),h.models.syncedGalleryPage=new h.Model.SyncedGalleryPage,h.models.syncedGalleryPage.setup(this.options.config)},regions:{rail:".js-rail",well:".js-well"},getClassConfigurations:function(a,b){return this.options&&this.options.classConfigurations&&this.options.classConfigurations[a]?d.extend({},this.options.classConfigurations[a],b):b},onRender:function(){new h.Router.Router,this.galleries=new h.View.Galleries(this.getClassConfigurations("app.View.Galleries",{collection:h.models.syncedGalleryPage.get("galleries")})),this.promoGalleries=new h.View.PromoGalleries({wellGalleriesView:this.galleries,collection:h.models.syncedGalleryPage.get("promoGalleries")})}}),h.Layout.VerticalLayout=h.Layout.CommonLayout.extend({template:a.PGM.JST["gallery/vertical-layout"],getConfiguration:{classConfigurations:{"app.View.Galleries":{className:"vertical-galleries",childViewOptions:{className:"vertical-gallery",template:a.PGM.JST["gallery/vertical-gallery"],childViewContainer:".gallery-slides"}}}},events:{"click .disqus__toggle":"openComments"},openComments:function(){this.$(".disqus__toggle").toggleClass("is-showing-comments"),this.$(".disqus").toggleClass("disqus__toggle--show")},initDisqus:function(a){
var c=a,d=b.createElement("script");d.type="text/javascript",d.async=!0,d.src="//"+c+".disqus.com/embed.js",(b.getElementsByTagName("head")[0]||b.getElementsByTagName("body")[0]).appendChild(d)},onRender:function(){h.Layout.CommonLayout.prototype.onRender.apply(this,arguments),this.well.show(this.galleries),this.rail.show(this.promoGalleries),this.initDisqus("billboardcom")}}),h.Router.Router=e.Router.extend({routes:{"photos/:nid/:title/:slideNumber":"goToSlide"},initialize:function(){a.PGM.events.on("gallery:activeSlide",d.bind(function(c,e){var f=c.get("gallery");if("undefined"!=typeof f){var g="undefined"==typeof e.attr("data-slideHash")?1:e.attr("data-slideHash"),h=b.location.search;"undefined"==typeof h&&(h=""),this.navigate(f.get("coreCanonical")+"/"+g+h,{replace:!0}),d.defer(function(){a.PGM.events.trigger("gallery:activeSlide-post",c,e)})}},this)),this.on("route:goToSlide",d.bind(function(b,c,e){var f=+e;return Number.isNaN(f)?void a.PGM.debug("gallery","NaN",e,f):void(1!==f&&d.defer(d.bind(function(){h.models.syncedGalleryPage.goToSlide(f)},this)))},this))}}),h.on("start",function(){var b=c(".gallery-data-wrapper"),d=b.find("script");if(1!==d.length)return void a.PGM.debug("gallery","data script not found");try{h.configData=JSON.parse(d.html())}catch(b){return void a.PGM.debug("gallery","data script not parsable")}h.rootView=new h.Layout.VerticalLayout({config:h.configData,el:b}),h.rootView.render(),e.History.started&&e.history.stop(),e.history.start({pushState:"pushState"in a.history})}),c(function(){h.start()})}(this,this.document,this.jQuery,this._,this.Backbone,this.Marionette),function(a,b,c){var d=a.FormatDateInput={};c.extend(d,{patterns:{illegal_chars:/[^0-9\/]/g,regex_three_digits:/^[0-9]{3}/g,regex_seg_three_digits:/^[0|1]{1}[0-9]{1}\/[0-3]{1}[0-9]{2}/g,regex_seg_1:/^[0|1]{1}[0-9]{1}/g,regex_seg_1_slash:/^[0|1]{1}[0-9]{1}\//g,regex_one_digit_zero:/^[0]\//g,regex_one_digit:/[1-9]\//g,regex_seg_2:/^[0|1]{1}[0-9]{1}\/[0-3]{1}[0-9]{1}/g,regex_two_digit:/\/[1-9]{1}\//g,regex_seg_3:/^[0-9]{2}\/[0-9]{2}\/[0-9]{4}$/g,regex_no_slashes:/[0-9]{2}\/[0-9]{2}[\/]{1,4}/g},setAllTimers:function(a,b,c,e,f){"use strict";d.setIllegalCharsTimer(a,b),d.setSegOneTimer(a,c),d.setSegTwoTimer(a,e),d.setSegThreeTimer(a,f)},clearAllTimers:function(a,b,c,d){"use strict";clearInterval(a),clearInterval(b),clearInterval(c),clearInterval(d),a=0,b=0,c=0,d=0},evaluateState:function(a,b,c){"use strict";1===a.value.length&&0===b&&d.setSegOneTimer(a,b),4===a.value.length&&0===c&&d.setSegTwoTimer(a,c)},setIllegalCharsTimer:function(a,b){"use strict";b=setInterval(function(){d.removeIllegalChars(a)},50)},setSegOneTimer:function(a,b){"use strict";b=setInterval(function(){d.cleanSegmentOne(a,b)},50)},setSegTwoTimer:function(a,b){"use strict";b=setInterval(function(){d.cleanSegmentTwo(a,b)},50)},setSegThreeTimer:function(a,b){"use strict";b=setInterval(function(){d.cleanSegmentThree(a)},50)},removeIllegalChars:function(a){"use strict";d.patterns.illegal_chars.test(a.value)&&(a.value=a.value.replace(d.patterns.illegal_chars,""))},cleanSegmentOne:function(a,b){"use strict";var c,e=a.value,f=a.value.length;1===f&&"/"===e&&(a.value=""),2===f&&d.patterns.regex_one_digit.test(e)&&(a.value="0"+e,clearInterval(b),b=0),2===f&&d.patterns.regex_one_digit_zero.test(e)&&(a.value=""),2===f&&"00"===e&&(a.value=""),2===f&&(c=e,c>12&&(a.value=e.replace(c,""))),2===f&&d.patterns.regex_seg_1.test(e)&&(a.value=a.value+"/",clearInterval(b),b=0),3===f&&d.patterns.regex_seg_1_slash.test(e)&&(clearInterval(b),b=0)},cleanSegmentTwo:function(a,b){"use strict";var c,e,f=a.value.substring(0,3);4===a.value.length&&a.value===f+"/"&&(a.value=f),5===a.value.length&&(c=a.value.substring(3),c>31&&(a.value=a.value.replace(c,""))),5===a.value.length&&a.value===f+"0/"&&(a.value=f),5===a.value.length&&"00"===c&&(a.value=a.value.replace(c,"")),5===a.value.length&&d.patterns.regex_two_digit.test(a.value)&&(e=a.value.substring(3,4),a.value=f+"0"+e),5===a.value.length&&d.patterns.regex_seg_2.test(a.value)&&(a.value=a.value+"/",clearInterval(b),b=0),6===a.value.length&&d.patterns.regex_seg_2.test(a.value)&&(clearInterval(b),b=0)},cleanSegmentThree:function(a){"use strict";var b;"/"!==a.value.substring(6,7)&&"/"!==a.value.substring(7,8)&&"/"!==a.value.substring(8,9)&&"/"!==a.value.substring(9,10)||(a.value=a.value.substring(0,a.value.length-1)),10===a.value.length&&d.patterns.regex_seg_3.test(a.value)&&(b=a.value),a.value.length>10&&(a.value=a.value.substring(0,a.value.length-1))},registerInputClass:function(a){"use strict";return{formatDate:function(){var e,f=b.getElementsByClassName(a),g=0,h=0,i=0,j=0,k=0;e=c(f),e.on("focus",function(){d.setAllTimers(this,g,h,i,i)}),e.on("keypress",function(a){k>1&&a.preventDefault(),k++}),e.on("keyup keydown",function(){var a=this.value.substring(2,3),b=this.value.substring(5,6);k=0,3===this.value.length&&d.patterns.regex_three_digits.test(this.value)&&(this.value=this.value.substring(0,this.value.length-1)+"/"+a),6===this.value.length&&d.patterns.regex_seg_three_digits.test(this.value)&&(this.value=this.value.substring(0,this.value.length-1)+"/"+b),d.evaluateState(this,h,i)}),e.on("blur",function(){d.clearAllTimers(g,h,i,j)})}}}})}(this,this.document,this.jQuery),function(a,b,c,d){a.fn.archiveSearch=function(){var d=c.FormatDateInput.registerInputClass("archive-search__input");d.formatDate();var e=new Date("1954-01-01"),f="We don't have data for that year. Try searching for a date after 1953.",g="We're still working on predicting the future. Try searching for a date in the past.",h="Check the date you entered. You might have missed some digits.";return this.each(function(){var d=a(this),i=d.find(".archive-search__form"),j=i.attr("data-message-template"),k=i.attr("data-archive-template"),l=c.PGM.JST[j],m=c.PGM.JST[k],n=d.find(".search-results");d.find(".archive-search__close").on("click",function(){d.find(".archive-search__input").val(""),d.removeClass("is-returning-result")}),i.on("submit",function(c){c.preventDefault(),n.html(l({message:"Loading&hellip;"})),d.addClass("is-returning-result");var j=d.find(".archive-search__input").val(),k=j.split("/"),o=[k[2],k[0],k[1]].join("-"),p=new Date(o),q=null;return p.valueOf()<e.valueOf()?q=f:p.valueOf()>Date.now()?q=g:10!==j.length&&(q=h),q?void n.html(l({message:q})):void a.ajax(i.data("ajax-url-prefix")+o+"/5",{success:function(c){if(b.isEmpty(c.rows))return void n.html(l({message:"We can't find data for "+j+". Try another date?"}));var d=c.rows[0].date;d=d.substring(5,7)+"/"+d.substring(8,10)+"/"+d.substring(0,4),n.html(m(a.extend(c,{archiveURL:n.data("base-url")},{convertedDate:d})))},error:function(a,b,c){n.html(l({message:"We're having trouble finding data for that date. Try another date?"})),console.error(c)}})})})},a(d).ready(function(){a(".archive-search").archiveSearch()})}(this.jQuery,this._,this,this.document),function(a){var b={positionCentered:"is-centered"};a.fn.pgmTooltip=function(c){var d=a.extend({},b,c);return this.each(function(){var b=a(this);if(b.addClass("pgm-tooltip"),b.hasClass("is-visible")){var c=b.parent().outerHeight()+5,e=b.parent().outerWidth(),f=c+"px",g=e+"px";b.addClass(d.positionCentered).css({bottom:f,width:g})}})}}(this.jQuery),function(a,b,c){c(b).ready(function(){c(".archive-search__input").on("focus",function(){c.cookie("archiveSearchTooltip","seen"),c(".archive-search__form").find(".pgm-tooltip").removeClass("is-visible")});var a=c.cookie("archiveSearchTooltip");a||c(".archive-search__tooltip").addClass("is-visible"),c(".archive-search__tooltip").pgmTooltip({positionCentered:"is-aligned-left"})})}(this,this.document,this.jQuery),function(a,b,c,d){a(c).ready(function(){if(!(a(".featured-video-promo-wrapper").length<1))try{b.PGM.touch||(a(".featured-video-promo-wrapper").css("display","block"),a(".video-promo").append('<script src="//players.brightcove.net/1125911414/028db90d-2f01-4434-ac5f-8fb691bc970a_default/index.min.js"></script><script type="text/javascript">var options = {"overlayText": "This data is supplied at initialization"}</script>'));var c=a(".video-js");if(0===c.length||"undefined"==typeof c[0].player)return;var d=a(".featured-video-promo");d.waypoint({handler:function(c){"down"===c?a(b).width()>1024&&(d.addClass("video-sidebar-unit"),d.animate({right:"50%",top:"0",width:"300px",marginLeft:"985px"},200)):"up"===c&&a(b).width()>1024&&(d.removeClass("video-sidebar-unit"),d.css("padding-top","495px"),d.animate({paddingTop:0,top:"-200px",width:"985px",height:"495px",marginLeft:"0",background:"transparent"},200))},offset:"-45%"})}catch(a){console.log(a.message)}})}(this.jQuery,this,this.document),function(a,b,c,d,e){var f="1125911414",g="b53f7820-22f7-4155-a1e0-1b6eb197280d";b.videoPlayer={},b.videoPlayer.Model=e.Model.extend({constructor:function(){this.playlist=new e.Collection,e.Model.apply(this,arguments)},initialize:function(){this.on("change:currentIndex",this.setCurrentVideo),this.set({brightcovePlayer:g,brightcoveAccount:f})},toJSON:function(){var a=this.get("currentVideo").toJSON(),b=this.get("currentIndex")+1,c=this.playlist.at(b<this.playlist.length?b:0).toJSON();return d.extend(d.clone(this.attributes),{currentVideo:a,nextVideo:c})},setCurrentVideo:function(){this.set("currentVideo",this.playlist.at(this.get("currentIndex")))},nextVideo:function(){var a=this.get("currentIndex")+1;a===this.playlist.length&&(a=0),this.set("currentIndex",a)},previousVideo:function(){var a=this.get("currentIndex");0===a&&(a=this.playlist.length),this.set("currentIndex",a-1)},parse:function(a){return this.playlist.reset(a.playlist),{currentIndex:0,currentVideo:this.playlist.at(0)}}}),b.videoPlayer.VideoPlayerView=e.View.extend({initialize:function(){this.listenTo(this.model,"change",this.render)},events:{"click .large-video__button--previous":"previousVideo","click .large-video__button--next":"nextVideo"},template:b.JST["homepage/videoPlayer"],render:function(){return this.$el.html(this.template(this.model.toJSON())),this},nextVideo:function(){this.model.nextVideo()},previousVideo:function(){this.model.previousVideo()}})}(this,this.PGM,this.jQuery,this._,this.Backbone),function(a,b,c){c(b).ready(function(){if("undefined"==typeof a.PGM.videoPlayer)throw{name:"Unmet Dependency",message:"Cannot initialize Homepage Video without PGM.videoPlayer and $.fn.setupVideoPlayer."};c(".large-video").each(function(){var b=JSON.parse(c(this).find("script").text());new a.PGM.videoPlayer.VideoPlayerView({el:this,model:new a.PGM.videoPlayer.Model({playlist:b},{parse:!0})}).render()})})}(this,this.document,this.jQuery),function(a,b,c){c(b).ready(function(){c(".js-toggle-disqus-comments").toggler({toggleTarget:"body",toggleClass:"is-showing-disqus-comments"})})}(this,this.document,this.jQuery),function(a){var b=window.PGM||{};if(b.BB=b.BB||{},b.BB.Spotify=b.BB.Spotify||{},"undefined"==typeof b.debug)throw{name:"Unmet Dependency",message:"SpotifyPreview needs PGM.debug"};return"undefined"==typeof b.geo?void b.debug("init","unknown country, bailing."):void a(document).ready(function(){var c=a(".js-chart-data");c.each(function(){var c=a(this),d=c.attr("data-spotifyType");if("undefined"==typeof d)return void b.debug("spotify","spotify preview could not find spotifyType");if("track"===d){var e=c.attr("data-chartCode");if("undefined"==typeof e)return void b.debug("spotify","spotify preview could not find chartCode");var f=c.attr("data-chartDate");if("undefined"==typeof f)return void b.debug("spotify","spotify preview could not find chartDate");a(".js-spotify-preview .js-play-button").addClass("is-loading"),a.ajax({type:"GET",url:"/fe-ajax/spotify/preview/chart-tracks/"+e+"/"+f+"/"+b.geo,success:function(a){return"undefined"!=typeof a.error?void b.debug("spotify","spotify preview by chart got an error",a):void b.BB.Spotify.PreviewManager.parse(c,a)}})}}),a("body").on("click",".js-spotify-preview.is-unprocessed",function(c){c.preventDefault();var d=a(this);d.removeClass("is-unprocessed"),d.find(".js-play-button").addClass("is-loading");var e=d.parents(".js-chart-data");if(0===e.length)return void b.debug("spotify","did not find a chart data parent for",this);var f=e.attr("data-spotifyType");if("undefined"==typeof f)return void b.debug("spotify","did not find a spotifyType in",e);var g=d.parents(".js-chart-row");if(0===g.length)return void b.debug("spotify","did not find a chart row parent for",this);var h=g.attr("data-spotifyId");if("undefined"==typeof h)return void b.debug("spotify","did not find a spotifyId in",g);var i="/fe-ajax/spotify/preview/"+f+"-tracks/"+h+"/"+b.geo;a.ajax({type:"GET",url:i,success:function(a){return"undefined"!=typeof a.error?void b.debug("spotify","spotify preview got an error",i,a):(b.BB.Spotify.PreviewManager.parse(g,a),void b.BB.Spotify.PreviewManager.playPreviews(g))}})})})}(this.jQuery),function(a,b){var c=window.PGM||{};c.BB=c.BB||{},c.BB.Spotify=c.BB.Spotify||{},c.BB.Spotify.PreviewManager={},c.BB.Spotify.PreviewManager.parse=function(b,d){b.find(".js-spotify-preview").removeClass("is-unprocessed"),b.find(".js-play-button").removeClass("is-loading"),Array.isArray(d)||(d=[d]);var e=b.attr("data-spotifyType");if("undefined"==typeof e)return void c.debug("spotify","spotify preview could not find spotifyType while parsing");for(var f=0,g=d.length;f<g;f++){var h=d[f],i=a(".js-chart-row[data-spotifyId="+h.originalId+"]");0!==i.length?(i.data("spotifyPreviews",h.previews),i.attr("data-spotifyPreview","yes")):c.debug("spotify","Could not find chart row for",h.originalId)}b.find(".js-chart-row").filter(":not([data-spotifyPreview])").each(function(){var b=a(this);b.find(".js-spotify-play-full").remove(),b.find(".js-spotify-preview").remove()})};var d=a(".js-audio-element");if(0===d.length)return void c.debug("spotify","Could not find audio element.");var e=d[0],f=null,g=-1,h=null,i=a(".js-svg-play-button-container");if(0===i.length)return void c.debug("spotify","Could not find svg play button container.");var j=i.find(".js-svg-play-button");if(0===j.length)return void c.debug("spotify","Could not find svg play button.");var k=j.find("#bar");if(0===k.length)return void c.debug("spotify","Could not find svg play button circle.");var l=k.attr("r"),m=Math.PI*(2*l);c.BB.Spotify.PreviewManager.movePlayButton=function(a){j.parents(".js-chart-row").removeClass("is-active");var b=a.find(".js-spotify-preview");return 0===b.length?void c.debug("spotify","svg: Could not find row play button."):(c.debug("spotify","svg: moving to",a),j.addClass("is-notransition"),k.css({strokeDashoffset:m}),j.removeClass("is-notransition"),j.appendTo(b),void j.parents(".js-chart-row").addClass("is-active"))},c.BB.Spotify.PreviewManager.pausePlayButton=function(){var a=k.css("strokeDashoffset");c.debug("spotify","svg: setting to "+a),j.addClass("is-notransition"),k.css({strokeDashoffset:a}),j.removeClass("is-notransition")},c.BB.Spotify.PreviewManager.playPlayButton=function(){var a=Math.round(100*(30-30*(m-parseFloat(k.css("strokeDashoffset")))/m))/100,b="stroke-dashoffset "+a+"s linear";k.css({transition:b}),c.debug("spotify","svg: setting target to 0 via "+b),k.css({strokeDashoffset:0})},c.BB.Spotify.PreviewManager.pauseIfPlaying=function(){null!==f&&f.find(".js-play-button").hasClass("is-playing")&&c.BB.Spotify.PreviewManager.playPreviews(f)},c.BB.Spotify.PreviewManager.playPreviews=function(a){if(c.debug.isEnabled("spotify")&&c.BB.Spotify.PreviewManager.debug(),"undefined"==typeof a)return null===f?void c.debug("spotify","Could not find current row."):null===h?void c.debug("spotify","Could not find current previews."):(g++,void(g>=0&&h.length>g?(e.src=h[g].previewUrl,e.play(),f.find(".js-play-button").removeClass("is-loading").addClass("is-playing"),b.defer(function(){c.BB.Spotify.PreviewManager.movePlayButton(f),c.BB.Spotify.PreviewManager.playPlayButton(),c.BB.Spotify.PreviewManager.trackPlay(f)})):(d.off(".playPreviews"),f.find(".js-play-button").removeClass("is-playing"),j.appendTo(i),f.removeClass("is-active"),f=null)));var k=a.is(f),l=a.find(".js-play-button");if(k)l.hasClass("is-playing")?(l.removeClass("is-playing").addClass("is-paused"),e.pause(),c.BB.Spotify.PreviewManager.pausePlayButton()):(l.removeClass("is-paused").addClass("is-playing"),e.play(),c.BB.Spotify.PreviewManager.playPlayButton(),c.BB.Spotify.PreviewManager.trackPlay(f));else{if(null!==f&&(f.find(".js-play-button").removeClass("is-loading").removeClass("is-playing").removeClass("is-paused"),e.pause()),f=a,g=-1,h=a.data("spotifyPreviews"),c.BB.Spotify.PreviewManager.movePlayButton(f),"undefined"==typeof h)return h=[],void c.debug("spotify","Could not find previews for.",a);d.on("ended.playPreviews",function(){c.BB.Spotify.PreviewManager.playPreviews()}),c.BB.Spotify.PreviewManager.playPreviews()}},c.BB.Spotify.PreviewManager.trackPlay=function(a){c.events.trigger("trackEvent",{action:"Preview Play",label:a.attr("data-songtitle")})},c.BB.Spotify.PreviewManager.debug=function(){null===h?console.log("no active previews"):h.length<=g?console.log(h.length+" active preview(s) have played."):console.log("playing. currentIndex is "+g," of "+h.length+"; playing "+e.src)},a("body").on("click","[data-spotifyPreview] .js-spotify-preview",function(b){b.preventDefault();var d=a(this).parents(".js-chart-row");return d.find(".is-loading").length>0?void c.debug("spotify","Clicked too early (while loading)"):void c.BB.Spotify.PreviewManager.playPreviews(d)})}(this.jQuery,this._),function(a,b){a.PGM.events.on("urlChange:post",function(c,d){var e;"video"===c&&(e=d.find(".video-main__title").text(),a.PGM.Header.setTitle(e),b('meta[name="twitter:title"]').attr("content",e))})}(this,this.jQuery);