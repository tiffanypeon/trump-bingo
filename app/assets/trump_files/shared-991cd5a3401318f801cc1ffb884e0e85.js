define("ab/libs/cookie",[],function(){"use strict";return{getCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},setCookie:function(e,t,n,r,i,o){var s;return n&&(1e3>n?(s=new Date,s.setTime(s.getTime()+24*n*60*60*1e3)):(s=new Date,s.setTime(s.getTime()+n))),document.cookie=e+"="+encodeURIComponent(t)+(r?";path="+r:";path=/")+(n?";expires="+s.toUTCString():"")+(i?";domain="+i:";domain=.nytimes.com")+(o?";secure":"")},deleteCookie:function(e,t,n,r){document.cookie=e+"=xxx"+(t?";path="+t:";path=/")+(n?";domain="+n:";domain=.nytimes.com")+(r?";secure":"")+"; expires=Thu, 01 Jan 1970 00:00:01 GMT;"}}}),define("ab/libs/logger",["ab/vendor/jquery","ab/libs/cookie"],function(e,t){"use strict";var n=function(e){this.prefix="["+e+"] ",this.levels={SILENT:0,ERROR:1,WARN:2,INFO:3,DEBUG:4};var n=t.getCookie("abTestLogLevel");n=null===n?this.levels.SILENT:parseInt(n,10),this.setLevel(n)};n.prototype={getLevelKey:function(e){var t,n=this.levels;for(t in n)if(n.hasOwnProperty(t)&&n[t]===e)return t;return null},setLevel:function(e){if(null===this.getLevelKey(e))throw new Error("Wrong log level");this.level=e,e>0?t.setCookie("abTestLogLevel",this.level):t.deleteCookie("abTestLogLevel")},log:function(e,t){var n,r;if(n="undefined"==typeof t?this.levels.INFO:t,r=this.getLevelKey(n),null===r)throw new Error("Wrong log level");return this.level!==this.levels.SILENT&&window.console&&n<=this.level?(console.log(r+" "+this.prefix+e),!0):!1},error:function(e){return this.log(e,this.levels.ERROR)},warn:function(e){return this.log(e,this.levels.WARN)},info:function(e){return this.log(e,this.levels.INFO)},debug:function(e){return this.log(e,this.levels.DEBUG)}};var r={};return n.get=function(e){return e=e||"global",r.hasOwnProperty(e)||(r[e]=new n(e)),r[e]},n}),define("ab/libs/url",["ab/vendor/jquery","ab/libs/logger"],function(e,t){"use strict";var n={},r=t.get("url");return n.parseUri=function(e){for(var t=n.parseUri.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),i={},o=14;o--;)i[t.key[o]]=r[o]||"";return i[t.q.name]={},i[t.key[12]].replace(t.q.parser,function(e,n,r){n&&(i[t.q.name][n]=r)}),i},n.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n.buildUri=function(t){var n,r;return n=t.protocol+"://"+t.host,t.port&&(n+=":"+t.port),n+=t.path,e.isEmptyObject(t.queryKey)||(r=e.map(t.queryKey,function(e,t){return""===e?t:t+"="+e}).join("&"),n+="?"+r),t.anchor&&(n+="#"+t.anchor),n},n.getLocationHref=function(){return window.location.href},n.parseCurrentUri=function(){return this.parseCurrentUri.ret&&this.parseCurrentUri.ret.source===this.getLocationHref()||(this.parseCurrentUri.ret=n.parseUri(this.getLocationHref())),this.parseCurrentUri.ret},n.filterQuery=function(t){var n=/^[\w!%?\/@:~$&'()*+,;=\.-]*$/,i={};return e.each(t,function(e,t){n.test(t)?i[e]=t:r.info('Untrusted value for parameter "'+e+'"')}),i},n.filterQueryInUri=function(e){var t=this.parseUri(e);return t.queryKey=this.filterQuery(t.queryKey),this.buildUri(t)},n.filterQueryInCurrentUri=function(){return this.filterQueryInUri(this.getLocationHref())},n.getLocationWithoutQuery=function(){var e=this.parseCurrentUri();return e.protocol+"://"+e.authority+e.path},n.getLocationSearch=function(){var e=this.parseCurrentUri();return e.query||""},n.getParameter=function(e){var t=this.parseCurrentUri();return t.queryKey[e]},n.getCampaignId=function(){return"string"!=typeof this.getCampaignId.ret&&(this.getCampaignId.ret=this.getParameter("campaignId")),this.getCampaignId.ret},n.getLocationSearchWithout=function(){var t,n=[],r=this.parseCurrentUri();for(t in r.queryKey)r.queryKey.hasOwnProperty(t)&&-1===e.inArray(t,arguments)&&(""===r.queryKey[t]?n.push(t):n.push(t+"="+r.queryKey[t]));return n.join("&")},n.getScrubbedQueryString=function(){var e,t=["OC","oc","EXIT_URI","exit_uri","URI","uri"];for(e=0;e<t.length;e++)[].push.call(arguments,t[e]);return this.getLocationSearchWithout.apply(this,arguments)},n.appendParamsToUrl=function(t,r,i){var o,s;return i="undefined"==typeof i?!0:i,s=i?n.parseCurrentUri().queryKey:{},o=this.parseUri(t),o.queryKey=e.extend({},o.queryKey,s,r),this.buildUri(o)},n.addSpecifiedParamsToLinks=function(e){this.appendParamsToLinks(e,!1)},n.appendParamsToLinks=function(t,i){i="undefined"==typeof i?!0:i,e.each(t,function(t,o){return 0===e(o.selector).length?void r.error("Element does not exist: "+o.selector):void e(o.selector).each(function(){var t=e(this).attr("href");return t?void e(this).attr("href",n.appendParamsToUrl(t,o.params,i)):void r.error('Unable to get "href" from element '+o.selector)})})},n.navigateTo=function(e){window.location.href=e},n}),define("ab/libs/utils",["ab/vendor/jquery","ab/libs/cookie","ab/libs/logger","ab/libs/url"],function(e,t,n,r){"use strict";var i={},o=n.get("utils");return i.camelCase=function(e){return e.replace(/^-ms-/,"ms-").replace(/-([a-z]|[0-9])/gi,function(e,t){return(t+"").toUpperCase()})},i.inherits=function(t,n,r){var i,o=t;i=n&&n.hasOwnProperty("constructor")?n.constructor:function(){return o.apply(this,arguments)},e.extend(i,o,r);var s=function(){this.constructor=i};return s.prototype=o.prototype,i.prototype=new s,n&&e.extend(i.prototype,n),i.__super__=o.prototype,i.__super__.constructor=o,i},function(){var e={};i.Template=function(t,n){var r=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');"):e[t]=e[t]||i.Template(document.getElementById(t).innerHTML);return n?r(n):r}}(),i.getMeter=function(t){var n=i.getCookie("nyt-m"),r=i.parseUri("?"+n).queryKey,s={};return t=t||["t","v","ft","fv"],e.each(t,function(e,t){s[t]=0}),e.each(t,function(e,t){"undefined"==typeof r[t]&&o.debug("FAILED to parse Meter cookie ("+t+" param)"),s[t]=r[t]?parseInt(r[t].toString().substr(2),10):0}),s},i.trimText=function(e,t){var n;return e=e||"",e.length>t&&(e=e.substr(0,t-1),n=e.lastIndexOf(" "),t-1>n&&(e=e.substr(0,n)+"...")),e},i.appendToHref=function(t){var n,r,i=function(){r=e(this).attr("href")+t[n].code,e(this).attr("href",r)};if("object"!=typeof t||"undefined"==typeof t.length)throw new Error("Parameter should be an array");for(n=0;n<t.length;n++)e(t[n].selector).each(i)},i.updateHdLinks=function(e,t){var n={selector:e,params:{CMP:r.getCampaignId()}};t&&(n.params.lp_id=t),r.appendParamsToLinks([n],!1)},i.updateOrderLinks=function(e,t){var n=t||!1;r.appendParamsToLinks([{selector:e,params:{campaignId:r.getCampaignId()}}],n)},i.updateAllOrderLinks=function(e,t,n){i.updateOrderLinks(e),i.updateHdLinks(t,n)},i.runWhenReady=function(e,t,n,r){setTimeout(function i(){e()?t():--r&&setTimeout(i,n)},n)},i.appendStyleTag=function(e){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t),t},i.getTarget=function(e){var t;return e||(e=window.event),e.target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),t},i.isLeftButton=function(e){e=e||window.event;var t=e.which||e.button;return 1===t},i.getCookie=function(e){return t.getCookie(e)},i.setCookie=function(e,n,r,i,o,s){return t.setCookie(e,n,r,i,o,s)},i.promiseSelector=function(t,n){var r=e.Deferred();return e(t).length?r.resolve(e(t)):e(document).on(n,function(n){r.resolve(e(t))}),r.promise()},i.cookie=function(t,n,r){if("undefined"==typeof n){var i=null;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";"),s=0;s<o.length;s++){var a=e.trim(o[s]);if(a.substring(0,t.length+1)===t+"="){i=decodeURIComponent(a.substring(t.length+1));break}}return i}r=r||{},null===n&&(n="",r.expires=-1);var c="";if(r.expires&&("number"==typeof r.expires||r.expires.toUTCString)){var u;"number"==typeof r.expires?(u=new Date,u.setTime(u.getTime()+24*r.expires*60*60*1e3)):u=r.expires,c="; expires="+u.toUTCString()}var l=r.path?"; path="+r.path:"",f=r.domain?"; domain="+r.domain:"",p=r.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(n),c,l,f,p].join("")},i.parseUri=function(e){return r.parseUri(e)},i.getScrubbedQueryString=function(){var e=r.parseCurrentUri().anchor,t=r.getScrubbedQueryString();return e&&(t+="#"+e),t},i.getLocationWithoutQuery=function(){return r.getLocationWithoutQuery()},i.getLocationSearch=function(){return r.getLocationSearch()},i.getCampaignId=function(){return r.getCampaignId()},i.appendParamsToUrl=function(e,t){return r.appendParamsToUrl(e,t)},i.appendParamsToLinks=function(e){return r.appendParamsToLinks(e)},i.queryToObject=function(e){for(var t,n={},r=e.replace(/^\?/,"").split("&"),i=r.length,o=0;i>o;o++)r[o]&&(t=r[o].split("="),n[t[0]]=t[1]);return n},i.preserveCurrentParams=function(t,n){var r,o,s,a={},c=i.getLocationSearch(),u=i.queryToObject(c);return t.indexOf("#")>-1&&(s=t.split("#"),t=s[0]),t.indexOf("?")>-1?(r=t.split("?"),a=i.queryToObject(r[1]),o=r[0]):o=t,u=e.extend({},u,a,n),o+"?"+e.param(u)+(s?"#"+s[1]:"")},i.appendHrefParams=function(t){e.each(t,function(t,n){if(0===e(n.selector).length)throw new Error("Element does not exist");e(n.selector).each(function(){var t=e(this).attr("href");if(!t)throw new Error('Unable to get "href" from element');e(this).attr("href",i.preserveCurrentParams(t,n.params))})})},i.constraintNumber=function(e,t,n){var r=parseInt(e,10),i=parseInt(t,10),o=parseInt(n,10);if(isNaN(r)||isNaN(i)||isNaN(o))throw new Error("all params should be specified and have a type of number");return r>o?o=r:o>i&&(o=i),o},i}),define("ab/libs/container",["ab/vendor/jquery","ab/libs/logger"],function(e,t){"use strict";var n=function(){var n;if(this.logger=t.get(this.name),!this.name)throw new Error("Name should be defined");if(this.deferred=e.Deferred(),this.conf=e.extend({},this.defaults,this.conf),this.container=e(this.conf.containerSelector),!this.container.length)throw new Error("Container element was not found in the DOM: "+this.conf.containerSelector);this.container.addClass(this.conf.className),this.events=e({});for(n in this.conditionsClassMap)this.conditionsClassMap.hasOwnProperty(n)&&this.conditionsClassMap[n]&&this.conditionsClassMap[n].apply&&this.conditionsClassMap[n]()&&this.container.addClass(n);this.initialize.apply(this,arguments)};return n.prototype={name:"",defaults:{containerSelector:"body",className:"abtest-container"},conditionsClassMap:{},conf:null,container:null,deferred:null,events:null,initialize:function(){},changeDom:function(){return this.deferred.resolve(),this.deferred.promise()},setTracking:function(){},getPromise:function(){return this.deferred.promise()}},n}),define("ab/libs/factor",["ab/vendor/jquery","ab/libs/utils","ab/libs/logger","ab/libs/container"],function(e,t,n,r){"use strict";var i=t.inherits(r,{conf:{className:"abtest-factor"}});return i}),define("ab/libs/variation",["ab/vendor/jquery","ab/libs/utils","ab/libs/logger","ab/libs/container"],function(e,t,n,r){"use strict";var i=t.inherits(r,{factors:null,_factors:null,conf:{className:"abtest-variation"},initialize:function(){if(this.factors=this.factors||[],this._factors=[],this.factors.length)for(var e=0,t=this.factors.length;t>e;e++)this._factors.push(new this.factors[e])},changeDom:function(){this.logger.debug("fn.changeDom");var t,n=[];if(this._factors.length){for(var r=0,i=this._factors.length;i>r;r++)t=this._factors[r],n.push(t.changeDom());e.when.apply(e,n).always(this.deferred.resolve)}else this.deferred.resolve();return this.deferred.promise()},setTracking:function(){this.logger.debug("fn.setTracking");var e;if(this._factors.length)for(var t=0,n=this._factors.length;n>t;t++)e=this._factors[t],e.setTracking()}});return i}),define("ab/libs/test/test",["ab/vendor/jquery","ab/libs/utils","ab/libs/logger","ab/libs/container"],function(e,t,n,r){"use strict";var i=t.inherits(r,{initialize:function(t){this.conf=e.extend({},this.conf,t)},conf:{className:"abtest-test",testId:"",jsHost:"",revision:0},variation:null,variationId:null,isAllocated:function(){throw new Error("fn.isAllocated is not implemented")},allocateVariation:function(){throw new Error("fn.allocateVariation is not implemented")},applyVariation:function(){throw new Error("fn.applyVariation is not implemented")},trackEvent:function(){throw new Error("fn.trackEvent is not implemented")},restoreContainers:function(){throw new Error("fn.restoreContainers is not implemented")},runExperiment:function(){throw new Error("fn.runExperiment is not implemented")}});return i}),define("ab/libs/test/strict_test",["ab/vendor/jquery","ab/libs/utils","ab/libs/test/test"],function(e,t,n){"use strict";var r=t.inherits(n,{allocate:function(){var t=this,n=this.conf.engine.allocate(),r=this._createTimeOut(n);return e.when(r,n).done(function(e,n){var r=n[0],i=n[1];t.logger.debug("[allocation] Allocated to "+r+" variation."),i?t.impressionSent=t.conf.trackerFacade.sendImpression(r):(t.impressionSent=!1,t.logger.debug("[allocation] skipping allocation calls")),t.variationId=r}).fail(function(e){t.variationId=e||-1})},waitForImpression:!1,getCampaignId:function(){return""},_createTimeOut:function(t){var n=e.Deferred();return t.then(function(){n.resolve()}),setTimeout(function(){n.reject()},8e3),n.promise()},applyVariation:function(){this.variation=new this.conf.variations[this.variationId](this),this.variation.changeDom(),this.variation.setTracking(this.trackingStrategyInst)},setTracking:function(){this.trackingStrategyInst.setTracking(this.selectorConversions),this.trackingStrategyInst.apply(this)},changDom:function(){},restoreContainers:function(){e(this.conf.containerSelector).show()},getInfo:function(){var e=this.conf;return{name:this.name,variationId:this.variationId,trackers:e.trackers||{}}},applyExperiment:function(){this.changDom(),this.applyVariation(),this.setTracking(),this.restoreContainers(),this.deferred.resolve()},runExperiment:function(){var t=this,n=this.conf.trackingStrategy;this.trackingStrategyInst=new n(this.conf.trackerFacade),this.allocate().then(function(){t.waitForImpression?e.when(t.impressionSent).always(function(){t.applyExperiment()}):t.applyExperiment()}).fail(function(e){t.restoreContainers(),t.deferred.reject(e)})}});return r}),define("ab/libs/tracking_facade",["ab/vendor/jquery"],function(e){"use strict";var t=function(e){this.trackers=e};return t.prototype={trackEvent:function(e,t){var n,r=[];for(var i in this.trackers)this.trackers.hasOwnProperty(i)&&(n="_"+i+"TrackEvent",this[n]&&r.push(this[n](e,this.trackers[i],t)));return this._promisesWithTimeOut(r)},_promisesWithTimeOut:function(t){var n=e.when.apply(e,t),r=this._createTimeout(n);return e.when(n,r)},_createTimeout:function(t){var n=e.Deferred();return setTimeout(n.reject,2e3),t.then(n.resolve),n.promise()},sendImpression:function(e){return this._callExistingMethodWithPromise("sendImpression",[e])},setAttrs:function(e){this._callExistingMethod("setAttrs",[e])},_callExistingMethod:function(e,t){for(var n in this.trackers)this.trackers.hasOwnProperty(n)&&this.trackers[n][e]&&this.trackers[n][e].apply(this.trackers[n],t)},_callExistingMethodWithPromise:function(e,t){var n=[];for(var r in this.trackers)this.trackers.hasOwnProperty(r)&&this.trackers[r][e]&&n.push(this.trackers[r][e].apply(this.trackers[r],t));return this._promisesWithTimeOut(n)},_guaTrackEvent:function(e,t){var n=e.params;return t.trackEvent(n.category,n.action,n.label,n.value)},_evtTrackEvent:function(e,t,n){return t.trackEvent(e.getParams())},_tagxTrackEvent:function(e,t,n){return t.trackEvent(e.getParams())}},t}),define("ab/libs/conversion",["ab/vendor/jquery"],function(e){"use strict";var t=function(t){var n={selector:"",eventType:"click",onActivate:function(){},action:"click",category:void 0,label:void 0,value:void 0,preventedEvents:[]};this.params=e.extend({},n,t),this.selector=this.params.selector,this.eventType=this.params.eventType,this.preventedEvents=this.params.preventedEvents};return t.prototype={isVoid:function(){return this.params.isVoid},activate:function(e,t){this.params.onActivate.apply(this.params,[t,e])},clone:function(n){var r=e.extend(!0,{},this.params,n);return new t(r)},getParams:function(){return{action:this.params.action,category:this.params.category,label:this.params.label,value:this.params.value}}},t}),define("ab/libs/tracking_strategies/tracking_strategy",["ab/vendor/jquery","ab/libs/utils"],function(e,t){"use strict";var n=!1;/iphone|ipod|ipad/gi.test(navigator.appVersion)&&(window.onpageshow=function(e){n=!1,e.persisted&&(n=!0)});var r=function(e){this.trackerFacade=e,this.initialize()};return r.prototype={initialize:function(){},setTracking:function(){},apply:function(e){},_targetType:function(e){if(e.is("a")||e.parents("a").length>0)return"link";var t='input[type="submit"], button',n=e.is(t)||e.parents(t).length>0,r=e.parents("form");return n&&r.length>0&&(r.attr("action")||r.attr("onsubmit"))?"form":!1},_getLink:function(e){return e.is("a")?e:e.parents("a").eq(0)},_isHrefValid:function(e){var t=this._getLink(e).attr("href"),n=/^javascript:|^#|^mailto:/gim;return!t||t.match(n)?!1:!0},_isIntendedToFollow:function(e){return t.isLeftButton(e)&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&!e.altKey},_isLinkToCauseReload:function(t){if(n)return!1;var r=this._isHrefValid(t),i=this._getLink(t).attr("target")||"_self",o=e.inArray(i,["_self","_parent","_top"])>-1;return r&&o?!0:!1},_redirect:function(e){if(!e)throw new Error("Empty href passed as a destination!");location.href=e},_followLink:function(t){return e.proxy(function(){var e=this._getLink(t).attr("href"),n=this;-1!==navigator.appVersion.indexOf("Mac")&&(window.onunload=function(){}),setTimeout(function(){n._redirect.call(n,e)},0)},this)},_getForm:function(e){return e.parents("form").eq(0)},_checkFormValidity:function(e){return e.checkValidity?e.checkValidity():!0},_submitForm:function(t){return e.proxy(function(){var e=this._getForm(t);this._checkFormValidity(e[0])&&e.submit()},this)},_linkGuard:function(e,t,n){switch(this._targetType(e)){case"link":var r=this._isIntendedToFollow(t),i=this._isLinkToCauseReload(e);return i&&r?(n.always(this._followLink(e)),!1):!0;case"form":return n.always(this._submitForm(e)),!1;default:return!0}},trackEvent:function(e,t){return e.activate(this.activator,t),this.trackerFacade.trackEvent(e,t)},_recordEvent:function(e,t,n){var r=this.trackEvent(e,t);return e.isVoid()?!0:this._linkGuard(t,n,r)}},r}),define("ab/libs/tracking_strategies/delegation_tracking_strategy",["ab/libs/tracking_strategies/tracking_strategy","ab/libs/utils","ab/vendor/jquery","ab/libs/conversion"],function(e,t,n,r){"use strict";var i=t.inherits(e,{initialize:function(){this.conversions=[]},setTracking:function(e){return"undefined"==typeof e?!0:(e instanceof Array||(e=[e]),e=this._makeConversions(e),void(this.conversions=this.conversions.concat(e)))},_makeConversions:function(e){for(var t=[],n=0;n<e.length;n++)t.push(new r(e[n]));return t},apply:function(e){this.activator=e;var t,r,i={},o=["blur","focus"],s=function(e){var t="";switch(e.eventType){case"blur":t="focusout";break;case"focus":t="focusin";break;default:t=e.eventType}e.eventType=t};for(t=0;t<this.conversions.length;t++)r=this.conversions[t],-1!==o.indexOf(r.eventType)?(s(r),this._listenTo(r.eventType+".ab",r.selector)):(this._isHrefValid(n(r.selector))&&"click"===r.eventType&&(this.conversions[t]=r=r.clone({eventType:"mouseup",preventedEvents:["click"]}),i.click=1),i[r.eventType]=1);for(var a in i)i.hasOwnProperty(a)&&this._listenTo(a+".ab")},_isSelector:function(e,t){return e.is(t)||!!e.parents(t).length},_handle:function(e){var r,i,o,s,a;for(r=0;r<this.conversions.length;r++)if(i=this.conversions[r],o=n(e.target),this._isSelector(o,i.selector)){if(n.inArray(e.type,i.preventedEvents)>-1&&t.isLeftButton(e)&&this._isLinkToCauseReload(o))return!1;if(i.eventType===e.type&&(s=i.preventedEvents.length>0,a=3===e.which,!s||!a))return this._recordEvent(i,o,e)}},_listenTo:function(e,t){var r=t||this.activator.conf.containerSelector,i=this;n(document).on(e,r,n.proxy(i._handle,i))}});return i}),define("ab/libs/user_info_api",[],function(){"use strict";var e=function(e){this.info=e};return e.prototype={isLoggedIn:function(){return parseInt(this.info.data.id)>0},isSubscriber:function(){var e=this.getSubscription(),t=0;for(var n in e)e.hasOwnProperty(n)&&(t|=parseInt(e[n]));return!!t},getSubscription:function(){return this.info.data.subscription}},e.getHost=function(){return location.host},e}),define("ab/libs/user_info",["ab/vendor/jquery","ab/libs/utils","ab/libs/user_info_api"],function(e,t,n){"use strict";function r(){return Date.now()+Math.round(100*Math.random())}var i=e.Deferred(),o="//www.nytimes.com/svc/web-products/userinfo.json",s=function(t){e.getJSON(o,{_:r()},function(e){t.resolve(e)})},a=function(n){e.ajax({url:o+"p",data:{cookie:t.getCookie("NYT-S"),_:r()},dataType:"jsonp",success:function(e){n.resolve(e)}})};return"www.nytimes.com"===n.getHost()?s(i):a(i),setTimeout(function(){i.reject()},1e4),{isLoggedIn:function(){var t=e.Deferred();return i.done(function(e){var r=new n(e);r.isLoggedIn()?t.resolve():t.reject()}).fail(function(){t.reject()}),t.promise()},api:function(){return i.pipe(function(e){return new n(e)})},isSubscriber:function(){var t=e.Deferred();return i.done(function(e){var r=new n(e);r.isSubscriber()?t.resolve():t.reject()}).fail(function(){t.reject()}),t.promise()},promise:i.promise()}}),define("ab/libs/page_info",["ab/vendor/jquery","ab/libs/utils"],function(e,t,n){"use strict";return{getMetaData:function(){var e={sourceApp:"nyt4",pageCount:t.getMeter().v,gwViews:t.getMeter().g,campaignId:t.getCampaignId()||void 0};window.NYTD&&window.NYTD.OC&&window.NYTD.OC.active&&(e.offerChain=window.NYTD.OC.active);var n,r,i,o=document.getElementsByTagName("meta"),s={PT:"",CG:"",SCG:"",byl:"",tom:"",hdl:"",ptime:"",cre:"",articleid:""},a={PST:"Error Page",errorpage:"true"};for(i=0;i<o.length;i+=1)n=o[i].getAttribute("name"),r=o[i].getAttribute("content"),"string"==typeof n&&"string"==typeof r&&(s.hasOwnProperty(n)&&(e[n]=r),"sourceApp"===n&&r!==e.sourceApp?e.sourceApp=r:a[n]===r&&(e.errorPage=1));return e}}}),define("ab/libs/engine/ga_status",[],function(){"use strict";var e=function(){};return e.live=["live","production"],e.draft=["draft","stg","preview"],e.isInLive=function(e){return"string"==typeof e&&-1!==this.live.indexOf(e.toLowerCase())},e.isInDraft=function(e){return"string"==typeof e&&-1!==this.draft.indexOf(e.toLowerCase())},e.isExists=function(e){return this.isInLive(e)||this.isInDraft(e)},e}),define("ab/libs/engine/ga",["ab/vendor/jquery","ab/libs/utils","ab/libs/logger","ab/libs/page_info","ab/libs/url","ab/libs/engine/ga_status"],function(e,t,n,r,i,o){"use strict";var s=function(t){this.logger=n.get("GA"),t=t||{},this.config=e.extend({},this.config,t),this._initApi()};return s.prototype={logger:null,cxApi:null,apiUrl:"//www.google-analytics.com/cx/api.js?experiment=",config:{propertyId:"UA-45312927-1",cookieDomain:"nytimes.com",experimentId:void 0},_initApi:function(){this.logger.debug("fn._initApi");var e=this._getDefaultAttrs();window.gab||(this._loadGaApi(),gab("create",this.config.propertyId,this.config.cookieDomain),gab("set",e),gab("send","pageview"),this.logger.info("created main tracker for property "+this.config.propertyId))},_loadGaApi:function(){this.logger.debug("fn._loadGaApi"),function(e,t,n,r,i,o,s){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(n),s=t.getElementsByTagName(n)[0],o.async=1,o.src=r,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","gab")},_loadCxApi:function(t){return this.logger.debug("fn._loadCxApi"),e.ajax({url:t,crossDomain:!0,dataType:"script"})},_isAllocated:function(){return this.logger.debug("fn._isAllocated"),this.cxApi?this.getVariation()!==this.cxApi.NO_CHOSEN_VARIATION:!1},_getDefaultAttrs:function(){var e=r.getMetaData();return this.logger.info("tracking"),{dimension1:e.pageCount,dimension2:e.gwViews,dimension4:e.sourceApp,dimension5:e.offerChain,dimension6:t.getCookie("nyt-d")?"true":"false",dimension7:e.errorPage,dimension8:e.PT,dimension9:e.CG,dimension10:e.SCG,dimension11:e.byl,dimension12:e.tom,dimension13:e.hdl,dimension14:e.ptime,dimension15:e.cre,dimension16:e.articleid,dimension17:e.PST,dimension18:e.campaignId}},getVariation:function(){if(!this.cxApi)throw new Error("cxApi is not loaded");return this.cxApi.getChosenVariation(this.config.experimentId)},allocate:function(){this.logger.debug("fn.allocate");var t=e.Deferred(),n=this;if("undefined"==typeof this.config.experimentId)throw new Error("conf.experimentId should be defined");var r=this.apiUrl+this.config.experimentId,i=!0;return e.when(this._loadCxApi(r)).done(function(){n.logger.info("cxApi is loaded for Experiment ID: "+n.config.experimentId),n.cxApi=window.cxApi,n.cxApi.setDomainName(n.config.cookieDomain),isNaN(parseInt(n.config.variationId,10))?n._isAllocated()?(n.logger.info("User is already allocated to variation"),i=!1):(n.logger.debug("Allocating to variation..."),n.cxApi.chooseVariation(n.config.experimentId)):(n.logger.info("Forcing variation "+n.config.variationId),n.cxApi.setChosenVariation(n.config.variationId,n.config.experimentId));var e=n.getVariation();return n.logger.info("Variation ID: "+e),-2===e?(n.logger.error("User is not part of experiment"),void t.reject(e)):-1===e||isNaN(e)?(n.logger.error("Allocation was not successful, abandoning experiment"),n.trackEvent("allocation","error",n.config.experimentId,e,{expId:n.config.experimentId,dimension24:e,nonInteraction:1}),void t.reject(e)):(n.setAttrs({expId:n.config.experimentId,expVar:n.getVariation()}),void t.resolve(n.getVariation(),i))}).fail(function(){n.logger.error("Unable to load CE API"),n.trackEvent("allocation","error",n.config.experimentId,-4,{expId:n.config.experimentId,dimension24:-4,nonInteraction:1}),t.reject(-4)}),t.promise()},sendImpression:function(){return this.trackEvent("allocation","impression",this.config.experimentId,this.getVariation(),{dimension24:this.getVariation(),nonInteraction:1})},setAttrs:function(e){this.logger.debug("fn.setAttrs"),gab("set",e)},trackEvent:function(){this.logger.debug("fn.trackEvent");var t,n=e.Deferred(),r=Array.prototype.slice.call(arguments,0),i={};return r.length?(t=r[r.length-1],e.isPlainObject(t)?i=t:r.push(i),i.hitCallback=n.resolve,r=["send","event"].concat(r),gab.apply(window,r),this.logger.info("GA event: "+JSON.stringify(r)),n.promise()):(this.logger.error("No event is sent"),n.resolve())},getUid:function(){var t=e.Deferred();return gab(function(e){var n=e.get("clientId");t.resolve(n)}),t.promise()}},s.getForcedVariationId=function(e,t){var n,r=this.getDebugVarFromUrl(e),i=parseInt(t,10);return void 0!==r?n=r:isNaN(i)||(n=i),n},s.getDebugVarFromUrl=function(e){var t,n,r;return o.isInDraft(e)&&(n=i.parseUri(window.location.search),r=parseInt(n.queryKey["var"],10),t=isNaN(r)?void 0:r),t},s}),define("ab/libs/common_events",["ab/vendor/jquery","ab/libs/logger"],function(e,t){"use strict";var n=function(){this.logger=new t("CommonEvents")};return n.prototype={logger:null,_sendEvent:function(t,n,r,i){t.trackEvent(n,r,e.extend({},i||{},{dimension3:"ab"}))},setOrderFormListeners:function(t){this.logger.debug("fn.setOrderFormListeners");var n=this;e(document).ready(function(){n._sendEvent(t,"orderForm","load",{nonInteraction:1})}),Event.observe(document,NYTD.Event.Tracking.PURCHASE_THANKYOU_LOAD,function(){var e=NYTD.OC&&NYTD.OC.subscribed&&NYTD.OC.subscribed.bundle_type,r={dimension20:e?NYTD.OC.subscribed.bundle_type:"-1"};n._sendEvent(t,"orderForm","thankyou",r)})},setRegiPageListeners:function(t){var n=this;this.logger.debug("fn.setRegiPageListeners"),e(document).ready(function(){n._sendEvent(t,"regiPage","thankyou")})},setMobileOrderFormListeners:function(t){var n=this;this.logger.debug("fn.setMobileOrderFormListeners"),e(document).ready(function(){var e;try{e=window.SERVER_SIDE_DATA.last_purchase.oc.original_bundle_name}catch(r){e="-1"}n._sendEvent(t,"orderForm","thankyou",{dimension20:e})})}},new n}),define("ab/libs/tracker/event_tracker",["ab/vendor/jquery","ab/libs/utils","ab/libs/logger"],function(e,t,n){"use strict";var r=function(e,t){t=t||{},this.attrs={},this.queue=[],this.logger=n.get("evtTracker"),this.isLiteTracking=t.isLiteTracking||!1,this.setAttrs({module:"ab",eventName:"abtest",subject:"adx-ab-allocation",referrer:document.referrer||""}),e&&this.setAttrs(e),t.liteTracking&&(this.liteTracking=t.liteTracking)};return r.prototype={setAttrs:function(t){this.attrs=e.extend(!0,{},this.attrs,t)},sendImpression:function(e){this.setAttrs({treatment:e}),this.trackEvent({action:"impression",url:window.location.href}),this.logger.debug("Sending impression with id: "+e),this.setAttrs({subject:"module-interactions"})},liteTracking:["impression"],trackEvent:function(t){if(t=e.extend(!0,{},this.attrs,t),this.isLiteTracking&&-1===e.inArray(t.action,this.liteTracking))return void this.logger.debug("Event Tracker Lite skipped "+JSON.stringify(t));try{return this._send(t)}catch(n){this._addToQueue(t)}return e.Deferred().reject().promise()},_getOfferChain:function(){var e=NYTD.OC?NYTD.OC.active:!1;return e||"noOfferChain"},_getTracker:function(){return this._trackerInst||(this._trackerInst=NYTD.EventTracker()),this._trackerInst},_send:function(t){var n=(t.action,e.Deferred());return this._getTracker().track(t,{callback:n.resolve}),this.logger.info("Event sent: "+JSON.stringify(t)),n.promise()},_addToQueue:function(e){this.queue.push(e),this._isWorkerSpawned()||this._spawnWorker()},_isWorkerSpawned:function(){return!!this._worker},_spawnWorker:function(){this._worker=setTimeout(e.proxy(this._clearQueue,this),500)},_clearQueue:function(){var e;try{for(;e=this.queue.shift();)this._send(e)}catch(t){this._addToQueue(e),this._spawnWorker()}}},r});
//# sourceMappingURL=shared.js.map