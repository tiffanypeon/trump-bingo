(function(a){jQuery.widget("ui.watchlist_listener",{options:{doLogin:true,confirmAccount:false,hasWatchlist:false},_init:function(){function o(){a(".add_to_watchlist a").removeAttr("onclick")}function k(){var f=a(document);if(!f.data("wl_init")){h=a();f.data("wl_init",true).data("$open",h).delegate(".add_to_watchlist a","click",function(){if(m.doLogin)a(window).trigger("initiate_login");else if(m.confirmAccount)window.location="/register-imdb/";else{var b=a(this);if(!b.hasClass("disabled")){var c=
b.closest(".add_to_watchlist");if(b.hasClass("wl_lists_btn"))c.hasClass("open")?c.trigger("close"):c.trigger("open");else if(b.hasClass("in_wl")){c.trigger("close");top.location="/list/watchlist"}else c.trigger("add");return false}}}).delegate(".wl_lists_btn","mouseenter",function(){p(a(this).closest(".add_to_watchlist"))}).click(function(b){if(h.size()!=0){b=a(b.target).closest(".add_to_watchlist");h.not(b).trigger("close")}}).delegate(".add_to_watchlist","open",function(){var b=a(this);b.addClass("open");
h=h.add(b);a(".wl_lists_btn",b).html("&#x25b2;");a(".wl-menu",b).show()}).delegate(".add_to_watchlist","close",function(){var b=a(this);b.removeClass("open");h=h.not(b);a(".wl_lists_btn",b).html("&#x25bc;");a(".wl-menu",b).hide()}).delegate(".add_to_watchlist","add",function(){var b=a(this),c=b.attr("data-const"),e=b.attr("data-lcn"),d=b.find("input"),g={tconst:c,lcn:e},i=j[c],n=a("a",i).addClass("disabled").filter(".wl_action_btn").html("<span>&nbsp;</span>Adding...").addClass("pending");g[d.attr("name")]=
d.val();b.trigger("close");a.ajax({url:"/list/_ajax/watchlist_add",type:"POST",data:g,beforeSend:window.addClickstreamHeadersToAjax,error:function(){n.html("Error on add").addClass("error")},success:function(q){if(q.status==200){n.html("<span>&nbsp;</span> In <u>Watchlist</u>").addClass("in_wl");a("a",i).removeClass("disabled pending");i.trigger("added.watchlist",{tconst:c,location:e,inwatchlist:true})}else n.html("Couldn't add")}})}).bind("wl_add",function(b,c){l(c)})}}function l(f){var b=[],c=a();
f.each(function(e,d){e=a(d);if(!e.data("wl_init")){d=e.attr("data-const");j[d]=j[d]||a();j[d]=j[d].add(e);b.push(d);c=c.add(e);e.data("wl_init",true)}});if(m.hasWatchlist)c.size()>0&&a.ajax({url:"/list/_ajax/watchlist_has",type:"POST",data:{consts:b,tracking_tag:"watchlist"},beforeSend:window.addClickstreamHeadersToAjax,error:function(){$b.html("Error checking").addClass("error")},success:function(e){if(e.status==200){o();c.each(function(d,g){d=a(g);g=d.attr("data-const");var i=d.attr("data-lcn");
if(e.has[g]){a(".wl_action_btn",d).html("<span>&nbsp;</span> In <u>Watchlist</u>").addClass("in_wl");d.trigger("ready.watchlist",{tconst:g,location:i,inwatchlist:true})}else{a(".wl_action_btn",d).html("Add to Watchlist");d.addClass("wl_ready").trigger("ready.watchlist",{tconst:g,location:i,inwatchlist:false})}});a("a",c).removeClass("disabled")}}});else{c.children(".wl_action_btn").html("Add to Watchlist");c.addClass("wl_ready").each(function(){var e=a(this),d=e.attr("data-const"),g=e.attr("data-lcn");
e.trigger("ready.watchlist",{tconst:d,location:g,inwatchlist:false})});a("a",c).removeClass("disabled")}}function p(f){if(!(a(".wl-lists",f).size()>0||f.data("wl-list")=="pending")){f.data("wl-list","pending");a.ajax({url:"/list/_ajax/wl_lists",data:{tconst:f.attr("data-const")},beforeSend:window.addClickstreamHeadersToAjax,error:function(){$b.html("Error loading").addClass("error")},success:function(b){if(b.status==200){a(".wl-menu",f).html(b.lists);f.data("wl-list",undefined)}else $b.html("Server error").addClass("error")}})}}
var h,m=this.options,j=[];k()},version:"2,0"})})(jQuery);(function(a){if(!("_gaq"in window))window._gaq=[];a(document).delegate(".add_to_watchlist","added.watchlist",function(o,k){var l=a(this).attr("data-ga-identifier");_gaq.push(["_trackEvent","watchlist","add_from_"+l,k.tconst]);_gaq.push(function(){consoleLog("watchlist add from "+l+" "+k.tconst,"gaq")})})})(jQuery);
