(function(c){jQuery.widget("ui.rating",{options:{widgetClass:"rating",errorMessage:"Oops! Please try again later.",ajaxURL:"/ratings/_ajax/title",starWidth:14,uconst:undefined,redirectURL:"/register/?why=vote"},_create:function(){function j(b){if(a.options.uconst){l();a.$cancel.removeClass("rating-hover").addClass("rating-pending");a.pendingRating=b;c.ajax({url:a.options.ajaxURL,type:"POST",dataType:"json",beforeSend:window.addClickstreamHeadersToAjax,data:{tconst:a.tconst,rating:a.pendingRating,
auth:a.authKey,tracking_tag:a.trackingTag},error:function(){return k()},success:function(d){if(d.status!=200)return k();if(a.pendingRating==0){a.originalRating=a.imdbRating;a.state="imdb"}else{a.originalRating=a.pendingRating;a.state="your"}d=a.pendingRating;a.pendingRating=undefined;a.$stars.removeClass("rating-hover");a.$caption.removeClass("rating-hover");a.$cancel.removeClass("rating-pending");e();m();c(a.element).trigger("change.rating",{state:a.state,rating:d,imdbRating:a.imdbRating,tconst:a.tconst})}})}else{b=
c("#nblogin");if(b.size()==0)document.location=a.options.redirectURL;else b.trigger("click")}}function e(){a.$stars.removeClass("rating-hover");a.$caption.removeClass("rating-hover");a.$cancel.removeClass("rating-hover");if(a.state=="your"){a.$stars.slice(0,a.originalRating).addClass("rating-your");a.$caption.addClass("rating-your");a.$cancel.addClass("rating-your");a.$lowerUserCaption.show()}else{a.$stars.removeClass("rating-your");a.$caption.removeClass("rating-your");a.$cancel.removeClass("rating-your");
a.$imdb.show();a.$lowerUserCaption.hide()}f(a.originalRating)}function f(b){a.$caption.children(":first").text(b||"-")}function k(){a.element.addClass("rating-error");a.element.html('<span class="rating-error-icon">&nbsp;</span><span class="rating-error-text">'+a.options.errorMessage+"</span>");return false}function l(){a.disabled=true}function m(){a.disabled=false}function n(b){var d=b.element[0].id.split("|"),o=d[1],p=d[2],i=b.options.starWidth;jQuery(".rating-ineligible",b.element).append('<img src="'+
b.options.images.info+'">');jQuery(".rating-imdb",b.element).remove();var q=o=="imdb"?b.options.images.imdb:b.options.images.your;jQuery(".rating-stars a",b.element).each(function(g){g=g+1;g='<a href="'+jQuery(this).attr("href")+'"><img width='+i+" height="+i+' src="'+(g<=p?q:b.options.images.off)+'"></a>';jQuery(this).replaceWith(g)});jQuery(".rating-cancel a",b.element).html("<img width="+i+" height="+i+' src="'+b.options.images.del+'"></a>')}var a=this;if(jQuery.browser.msie&&jQuery.browser.version<
7)return n(a);var h=a.element[0].id.split("|");a.tconst=h[0];a.state=a.originalState=h[1];a.originalRating=parseFloat(h[2]);a.imdbRating=parseFloat(h[3]);a.trackingTag=h[4]||"";a.disabled=false;a.$stars=c(".rating-stars a",a.element);a.$imdb=c(".rating-imdb",a.element);a.$cancel=c(".rating-cancel",a.element);a.$caption=c(".rating-rating",a.element);a.$lowerUserCaption=c(".star-bar-user-rate",a.siblings);a.$stars.removeAttr("href");c("a",a.$cancel).removeAttr("href");a.authKey=c(a.element).attr("data-auth");
c(a.element).trigger("ready.rating",{state:a.state,rating:a.originalRating,imdbRating:a.imdbRating,tconst:a.tconst});a.$stars.bind("mouseover.rating",function(){if(a.disabled)return false;var b=a.$stars.index(this)+1;a.state=="your"?a.$stars.removeClass("rating-your"):a.$imdb.hide();a.$stars.slice(0,b).addClass("rating-hover");a.$stars.slice(b+1).removeClass("rating-hover");a.$caption.addClass("rating-hover");a.$cancel.addClass("rating-hover");f(b)}).bind("mouseout.rating",function(){if(a.disabled)return false;
e()}).bind("click.rating",function(){if(a.disabled)return false;j(a.$stars.index(this)+1)});a.$cancel.bind("click.rating",function(){if(a.disabled)return false;j(0)})}});c.extend(c.ui.rating,{version:"2.0"})})(jQuery);(function(c){if(!("_gaq"in window))window._gaq=[];c(document).delegate(".rating","change.rating",function(j,e){var f=c(this).attr("data-ga-identifier");if(e.state==="your"){_gaq.push(["_trackEvent","rating","add_from_"+f,e.tconst]);_gaq.push(function(){consoleLog("rating add from "+f+" "+e.tconst,"gaq")})}})})(jQuery);
